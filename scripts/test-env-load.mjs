// Teste simples para verificar se as vari√°veis est√£o dispon√≠veis
// Simula o que o Next.js faz ao carregar .env.local

import { readFileSync } from 'fs';
import { resolve, dirname } from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
const projectDir = resolve(__dirname, '..');
const envPath = resolve(projectDir, '.env.local');

console.log('üîç Testando carregamento de .env.local...\n');
console.log('üìÅ Caminho do arquivo:', envPath);

try {
  const envContent = readFileSync(envPath, 'utf8');
  console.log('‚úÖ Arquivo .env.local encontrado e lido');
  
  // Simular parsing b√°sico (Next.js usa dotenv internamente)
  const envVars = {};
  envContent.split('\n').forEach(line => {
    line = line.trim();
    if (line && !line.startsWith('#')) {
      const match = line.match(/^([^=]+)=(.*)$/);
      if (match) {
        const key = match[1].trim();
        let value = match[2].trim();
        // Remover aspas se existirem
        if ((value.startsWith('"') && value.endsWith('"')) || 
            (value.startsWith("'") && value.endsWith("'"))) {
          value = value.slice(1, -1);
        }
        envVars[key] = value;
      }
    }
  });
  
  console.log(`\nüìã Total de vari√°veis encontradas: ${Object.keys(envVars).length}`);
  
  const criticalVars = [
    'DATABASE_URL',
    'NEXTAUTH_SECRET',
    'NEXTAUTH_URL',
    'OPENAI_API_KEY',
    'OPENAI_ASSISTANT_ID'
  ];
  
  console.log('\nüîë Vari√°veis cr√≠ticas:');
  let allPresent = true;
  criticalVars.forEach(varName => {
    if (envVars[varName]) {
      const masked = varName.includes('SECRET') || varName.includes('KEY')
        ? `${envVars[varName].substring(0, 10)}...`
        : envVars[varName].length > 50
        ? `${envVars[varName].substring(0, 30)}...`
        : envVars[varName];
      console.log(`   ‚úÖ ${varName}: ${masked}`);
    } else {
      console.log(`   ‚ùå ${varName}: N√ÉO ENCONTRADO`);
      allPresent = false;
    }
  });
  
  if (allPresent) {
    console.log('\n‚úÖ Todas as vari√°veis cr√≠ticas est√£o no arquivo!');
    console.log('\nüí° Se o servidor ainda n√£o iniciar, o problema pode ser:');
    console.log('   1. Next.js n√£o est√° carregando o .env.local corretamente');
    console.log('   2. H√° um erro de sintaxe/importa√ß√£o nos arquivos TypeScript');
    console.log('   3. H√° um problema com a ordem de carregamento dos m√≥dulos');
    console.log('\nüîç Execute "npm run dev" e verifique os logs de DEBUG que adicionamos');
  } else {
    console.log('\n‚ùå Algumas vari√°veis cr√≠ticas est√£o faltando no arquivo!');
  }
  
} catch (error) {
  console.error('‚ùå Erro ao ler .env.local:', error.message);
  process.exit(1);
}

