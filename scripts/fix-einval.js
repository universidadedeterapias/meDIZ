// Script para corrigir problemas EINVAL com symlinks no Windows/OneDrive
const fs = require('fs');
const path = require('path');

console.log('üîß Corrigindo problemas de symlinks no Windows/OneDrive...\n');

const nextDir = path.join(process.cwd(), '.next');

// Fun√ß√£o para remover diret√≥rio recursivamente, evitando problemas com symlinks
function removeDir(dirPath) {
  if (!fs.existsSync(dirPath)) {
    return;
  }

  try {
    const files = fs.readdirSync(dirPath);
    
    files.forEach(file => {
      const filePath = path.join(dirPath, file);
      
      try {
        const stat = fs.lstatSync(filePath); // lstat n√£o segue symlinks
        
        if (stat.isDirectory()) {
          removeDir(filePath);
        } else {
          // Remove arquivo ou symlink quebrado
          fs.unlinkSync(filePath);
        }
      } catch (err) {
        // Se n√£o conseguir ler, tenta remover diretamente
        try {
          fs.unlinkSync(filePath);
        } catch (e) {
          console.warn(`‚ö†Ô∏è  N√£o foi poss√≠vel remover: ${filePath}`);
        }
      }
    });
    
    // Remove o diret√≥rio vazio
    fs.rmdirSync(dirPath);
  } catch (err) {
    // Se falhar, tenta usar fs.rmSync (Node 14+)
    try {
      fs.rmSync(dirPath, { recursive: true, force: true });
    } catch (e) {
      console.error(`‚ùå Erro ao remover ${dirPath}:`, e.message);
    }
  }
}

// Remove .next completamente
if (fs.existsSync(nextDir)) {
  console.log('üóëÔ∏è  Removendo diret√≥rio .next...');
  removeDir(nextDir);
  console.log('‚úÖ Diret√≥rio .next removido com sucesso!\n');
} else {
  console.log('‚úÖ Diret√≥rio .next n√£o existe (j√° est√° limpo)\n');
}

console.log('‚úÖ Corre√ß√£o conclu√≠da! Agora execute: npm run dev\n');

