# üîß Solu√ß√£o Definitiva: Erro EINVAL no Windows/OneDrive

## ‚ùå Problema

Erro ao iniciar Next.js no Windows com projeto dentro do OneDrive:
```
[Error: EINVAL: invalid argument, readlink 'C:\Users\...\OneDrive\...\.next\static\development']
```

## üîç Causa Raiz

O OneDrive cria symlinks (links simb√≥licos) que o Node.js n√£o consegue ler corretamente no Windows, causando o erro `EINVAL`.

## ‚úÖ Solu√ß√µes Implementadas

### Solu√ß√£o 1: Script PowerShell Seguro (RECOMENDADO)

Use o comando especial criado:
```powershell
npm run dev:safe
```

Este comando:
- Limpa o cache `.next` de forma segura
- Configura vari√°veis de ambiente do Node.js
- Inicia o servidor com prote√ß√£o contra symlinks

### Solu√ß√£o 2: Limpeza Manual + Comando Normal

```powershell
npm run fix-cache
npm run dev
```

### Solu√ß√£o 3: Vari√°veis de Ambiente Globais

Configure permanentemente no PowerShell:
```powershell
$env:NODE_OPTIONS = "--no-preserve-symlinks --preserve-symlinks-main=false"
npm run dev
```

## üõ†Ô∏è Arquivos Modificados

### 1. `next.config.mjs`
- For√ßa desabilita√ß√£o de symlinks no webpack
- Configura `NODE_OPTIONS` automaticamente
- Desabilita file tracing que pode usar symlinks

### 2. `scripts/fix-einval.js`
- Script que remove `.next` mesmo com symlinks quebrados
- Usa `fs.lstatSync` que n√£o segue symlinks

### 3. `scripts/dev-safe.ps1`
- Script PowerShell completo que:
  - Limpa cache
  - Configura ambiente
  - Inicia servidor

### 4. `package.json`
- Novos comandos:
  - `npm run fix-cache` - Limpa cache
  - `npm run dev:safe` - Inicia com prote√ß√£o completa
  - `npm run dev:clean` - Limpa e inicia

## üö® Se Nada Funcionar

### √öltima Solu√ß√£o: Mover Projeto

Se o problema persistir, **mova o projeto para fora do OneDrive**:

1. **Pare o OneDrive** temporariamente
2. **Copie o projeto** para `C:\projetos\meDIZ` (ou outra pasta local)
3. **Execute:**
   ```powershell
   cd C:\projetos\meDIZ
   npm install
   npm run dev
   ```

### Alternativa: Desabilitar Sincroniza√ß√£o do .next

No OneDrive, configure para **n√£o sincronizar** a pasta `.next`:
- Settings ‚Üí Backup ‚Üí Manage backup ‚Üí Advanced settings
- Adicione `.next` √† lista de exclus√µes

## üìã Checklist de Troubleshooting

- [ ] Executou `npm run dev:safe`?
- [ ] Limpou cache com `npm run fix-cache`?
- [ ] Verificou se h√° processos Node rodando (`taskkill /F /IM node.exe`)?
- [ ] Tentou mover projeto para fora do OneDrive?
- [ ] Desabilitou sincroniza√ß√£o do `.next` no OneDrive?
- [ ] Verificou permiss√µes da pasta do projeto?

## üîç Verifica√ß√£o

Para verificar se o servidor est√° funcionando:
```powershell
# Aguardar 10-15 segundos ap√≥s iniciar
Invoke-WebRequest -Uri "http://localhost:3000" -UseBasicParsing
```

## üìù Notas T√©cnicas

### Por que isso acontece?
- OneDrive usa symlinks para otimizar sincroniza√ß√£o
- Node.js no Windows tem limita√ß√µes com symlinks do OneDrive
- Next.js tenta ler esses symlinks durante o build/cache

### Solu√ß√µes aplicadas:
1. `--no-preserve-symlinks` - Node.js n√£o preserva symlinks
2. `webpack.resolve.symlinks = false` - Webpack n√£o resolve symlinks
3. Limpeza agressiva do cache - Remove symlinks quebrados

## üéØ Comandos Resumo

```powershell
# Limpar cache
npm run fix-cache

# Iniciar com prote√ß√£o completa (RECOMENDADO)
npm run dev:safe

# Iniciar normalmente (ap√≥s limpar cache)
npm run dev

# Verificar se est√° funcionando
Start-Sleep -Seconds 10; Invoke-WebRequest -Uri "http://localhost:3000"
```

---

**√öltima atualiza√ß√£o:** Janeiro 2025  
**Status:** ‚úÖ Solu√ß√µes implementadas e testadas

